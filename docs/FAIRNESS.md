# Provable Fairness Guide

## What is Provable Fairness?

Provable fairness is a cryptographic method that allows players to verify that game results are truly random and not manipulated by the house. Our dice game uses industry-standard HMAC-SHA256 cryptography to ensure complete transparency.

## How It Works

### 1. Seed Generation

**Server Seed**: A random 128-character hexadecimal string generated by the server
- Example: `a1b2c3d4e5f6...` (128 characters)
- Kept secret until seed rotation
- Used as the key for HMAC generation

**Client Seed**: A string that you can customize
- Default: Random string generated for you
- You can change it anytime in the Fairness modal
- Provides your input into the randomness

**Nonce**: An incremental counter
- Starts at 0 for new accounts
- Increases by 1 with each bet
- Ensures each roll is unique even with same seeds

### 2. Hash Commitment

Before you place any bets, we show you the **SHA256 hash** of our server seed. This proves:
- We generated the server seed before you started betting
- We cannot change it without you knowing
- The seed will produce deterministic results

### 3. Roll Generation

For each bet, we generate your roll using this exact algorithm:

```javascript
// Step 1: Create message from your seeds and nonce
const message = `${clientSeed}:${nonce}`;

// Step 2: Generate HMAC using server seed as key
const hmac = HMAC_SHA256(serverSeed, message);

// Step 3: Take first 8 hex characters (32 bits)
const first8chars = hmac.substring(0, 8);

// Step 4: Convert to integer
const integerValue = parseInt(first8chars, 16);

// Step 5: Convert to float between 0 and 1
const floatValue = integerValue / 0xFFFFFFFF;

// Step 6: Scale to dice range (0.00 to 100.00)
const roll = Math.floor(floatValue * 10001) / 100;
```

### 4. Verification Process

After we rotate our server seed (revealing the old one), you can verify any previous roll:

1. **Get the revealed server seed** from seed rotation
2. **Use your client seed** from that time period
3. **Use the nonce** from the specific bet
4. **Run the same algorithm** to generate the roll
5. **Compare** with the roll shown in your bet history

## Step-by-Step Verification Example

Let's verify a roll with these values:
- **Server Seed**: `a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456789012345678901234567890abcdef1234567890abcdef12345678`
- **Client Seed**: `my-custom-seed`
- **Nonce**: `5`

### Step 1: Create Message
```
Message = "my-custom-seed:5"
```

### Step 2: Generate HMAC-SHA256
```
HMAC = HMAC_SHA256("a1b2c3d4e5f6...", "my-custom-seed:5")
Result = "8f2a1b3c4d5e6f7890abcdef12345678..."
```

### Step 3: Extract First 8 Characters
```
First8 = "8f2a1b3c"
```

### Step 4: Convert to Integer
```
Integer = parseInt("8f2a1b3c", 16) = 2401234748
```

### Step 5: Convert to Float
```
Float = 2401234748 / 4294967295 = 0.5589234
```

### Step 6: Calculate Roll
```
Roll = Math.floor(0.5589234 * 10001) / 100 = 55.89
```

## Using the Verification Tool

### In-Game Verification

1. **Open Fairness Modal**: Click the "Fairness" button in the header
2. **View Current Seeds**: See your current server seed hash and client seed
3. **Rotate Server Seed**: Click "Rotate Server Seed" to reveal the previous seed
4. **Verify Rolls**: Enter the revealed server seed, your client seed, and nonce to verify any roll

### Manual Verification

You can also verify rolls using any programming language or online tools:

**JavaScript Example**:
```javascript
const crypto = require('crypto');

function verifyRoll(serverSeed, clientSeed, nonce) {
  const message = `${clientSeed}:${nonce}`;
  const hmac = crypto.createHmac('sha256', serverSeed).update(message).digest('hex');
  const first8 = hmac.slice(0, 8);
  const intVal = parseInt(first8, 16);
  const float = intVal / 0xffffffff;
  const roll = Math.floor(float * 10001) / 100;
  return Number(roll.toFixed(2));
}

// Verify a roll
const result = verifyRoll(
  "a1b2c3d4e5f6...", // Server seed (revealed)
  "my-custom-seed",   // Your client seed
  5                   // Nonce from bet
);
console.log("Roll result:", result);
```

**Python Example**:
```python
import hmac
import hashlib

def verify_roll(server_seed, client_seed, nonce):
    message = f"{client_seed}:{nonce}"
    hmac_result = hmac.new(
        server_seed.encode(), 
        message.encode(), 
        hashlib.sha256
    ).hexdigest()
    
    first8 = hmac_result[:8]
    int_val = int(first8, 16)
    float_val = int_val / 0xffffffff
    roll = int(float_val * 10001) / 100
    return round(roll, 2)

# Verify a roll
result = verify_roll(
    "a1b2c3d4e5f6...",  # Server seed (revealed)
    "my-custom-seed",    # Your client seed
    5                    # Nonce from bet
)
print(f"Roll result: {result}")
```

## Security Guarantees

### What We Cannot Do

1. **Predict Your Rolls**: We don't know your client seed, so we cannot predict outcomes
2. **Change Past Results**: Server seed is committed via hash before betting
3. **Manipulate Specific Rolls**: HMAC ensures we cannot selectively change outcomes
4. **Hide Information**: All data needed for verification is provided

### What You Can Do

1. **Set Custom Client Seeds**: Use your own random strings
2. **Verify Any Roll**: Check any historical bet independently
3. **Audit Our System**: The algorithm is completely transparent
4. **Change Seeds Anytime**: Rotate seeds whenever you want

## Best Practices

### For Maximum Security

1. **Use Custom Client Seeds**: Don't rely only on our generated seeds
2. **Rotate Seeds Regularly**: Change your client seed periodically
3. **Verify Important Bets**: Check big wins/losses using the verification tool
4. **Keep Records**: Save server seed hashes and your client seeds
5. **Understand the Math**: Learn how the algorithm works

### Red Flags to Watch For

- Server seed hash changes without rotation
- Unable to verify rolls with revealed seeds
- Missing nonce or seed information
- Verification results don't match bet history

## Technical Details

### Why HMAC-SHA256?

- **Industry Standard**: Used by major crypto exchanges and gambling sites
- **Cryptographically Secure**: Impossible to reverse or predict
- **Deterministic**: Same inputs always produce same outputs
- **Tamper Evident**: Any change in inputs produces completely different output

### Why This Specific Algorithm?

- **Uniform Distribution**: Ensures all outcomes are equally likely
- **No Bias**: The modulo operation doesn't favor any particular range
- **Transparency**: Simple enough to implement and verify independently
- **Compatibility**: Matches algorithms used by other provably fair games

## Frequently Asked Questions

**Q: Can you see my client seed?**
A: Yes, but that doesn't matter. Even knowing your client seed, we cannot predict rolls because we've already committed to our server seed via the hash.

**Q: What if I use the same client seed as someone else?**
A: No problem. Each user has their own server seed and nonce counter, so results will be different.

**Q: How often should I rotate seeds?**
A: It's up to you. Some players rotate after big wins/losses, others do it regularly. More frequent rotation provides more verification opportunities.

**Q: Can I verify rolls from other gambling sites?**
A: Only if they use the same algorithm. Many sites use similar but slightly different implementations.

**Q: What happens if I lose my client seed?**
A: You can still verify rolls if you remember what client seed you were using at the time. The system shows your current client seed in the Fairness modal.

## Getting Help

If you need help with verification:

1. **Check the Fairness Modal**: Most verification can be done in-game
2. **Use Our Examples**: Copy the code examples above
3. **Contact Support**: We can help you verify specific bets
4. **Community Forums**: Other players often share verification tools

Remember: The whole point of provable fairness is that you don't have to trust us - you can verify everything yourself!